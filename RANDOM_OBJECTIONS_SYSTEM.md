# Система случайных возражений AI-пациента

## Описание
Система случайных возражений делает AI-пациента более реалистичным — он периодически сомневается и возражает **без видимых причин**, как настоящие клиенты в продажах.

## Принцип работы

### Когда появляются возражения?
- **НЕ в первых 2-3 сообщениях** — пациент сначала слушает
- **С вероятностью 25%** на каждое сообщение (настраивается через `randomObjectionChance`)
- **НЕ появляются** если администратор работает отлично (эмпатия >75%, отзывчивость >70%)
- **Заменяют эмоциональную реакцию** чтобы не перегружать ответ

### Типы возражений

#### 1. **Ценовые сомнения (price_doubt)**
Пациент внезапно начинает думать что это дорого:
```
"Знаете, мне кажется это дороговато... Может, есть что-то попроще?"
"А правда ли это стоит таких денег? Я видел в других местах дешевле..."
"Хм, цена кусается. Может, подождать какую-нибудь акцию?"
```

#### 2. **Сомнения во времени (time_doubt)**
Пациенту кажется что это слишком долго:
```
"Слушайте, а может это слишком долго? У меня нет столько времени..."
"Мне кажется, это займёт больше времени чем вы говорите."
"А нет способа быстрее? Я не могу так долго ждать результата."
```

#### 3. **Сомнения в доверии (trust_doubt)**
Пациент вдруг начинает не доверять:
```
"А вы точно в этом уверены? Просто я слышал разные мнения..."
"Хм, звучит хорошо, но как-то слишком хорошо... Есть подвох?"
"Извините за недоверие, но откуда такая уверенность в результате?"
```

#### 4. **Поиск альтернатив (alternative_seeking)**
Пациент вспоминает про другие варианты:
```
"А если я просто подожду? Может, само пройдёт?"
"Может, попробовать сначала что-то попроще, народное средство?"
"Я слышал про другой метод лечения, может он лучше?"
```

#### 5. **Сравнения с конкурентами (comparison_doubt)**
Пациент начинает сравнивать с другими клиниками:
```
"Знаете, у вас цены выше чем в соседней клинике..."
"А почему у конкурентов этот же сервис дешевле?"
"Мне друг посоветовал другое место, там говорят лучше..."
```

#### 6. **Страхи (fear_based)**
Внезапные страхи и опасения:
```
"А вдруг не поможет? Тогда деньги зря потрачу..."
"Мне страшно, что может что-то пойти не так..."
"А если мне станет хуже после этого?"
```

#### 7. **Прокрастинация (procrastination)**
Пациент хочет отложить решение:
```
"Может, я ещё подумаю пару дней?"
"Знаете, я бы хотел посоветоваться с семьей сначала..."
"Давайте я вернусь к этому вопросу через недельку?"
```

#### 8. **Мнение третьих лиц (third_party_opinion)**
Нужно спросить у кого-то ещё:
```
"Я должен посоветоваться с женой/мужем, без неё/него не решу."
"Мне нужно спросить у родителей, что они думают..."
"Давайте я сначала у своего доктора спрошу, что он скажет?"
```

## Примеры диалогов со случайными возражениями

### Пример 1: Ценовое возражение
```
Администратор: "Стоимость процедуры составляет 15000 рублей. Это включает консультацию и само лечение."

Пациент: "Знаете, мне кажется это дороговато... Может, есть что-то попроще?"
```

### Пример 2: Возражение по времени
```
Администратор: "Курс лечения займёт примерно 3 недели с посещениями 2 раза в неделю."

Пациент: "Слушайте, а может это слишком долго? У меня нет столько времени..."
```

### Пример 3: Сомнения в доверии
```
Администратор: "Мы гарантируем результат, наши специалисты имеют многолетний опыт."

Пациент: "Хм, звучит хорошо, но как-то слишком хорошо... Есть подвох?"
```

### Пример 4: Сравнение с конкурентами
```
Администратор: "У нас современное оборудование и опытные врачи."

Пациент: "Знаете, у вас цены выше чем в соседней клинике..."
```

### Пример 5: Прокрастинация
```
Администратор: "Отлично! Когда вам удобно записаться на приём?"

Пациент: "Может, я ещё подумаю пару дней?"
```

## Как администратор должен работать с возражениями

### ❌ Неправильно:
- Игнорировать возражение
- Отвечать односложно: "Нет, это не дорого"
- Быть агрессивным: "Мы лучшие, не нравится — идите в другое место"

### ✅ Правильно:
1. **Принять возражение**: "Понимаю ваши сомнения..."
2. **Уточнить детали**: "Что именно вас смущает в цене?"
3. **Аргументировать ценность**: "Эта цена включает..."
4. **Предложить варианты**: "Мы можем предложить рассрочку..."
5. **Вернуть фокус на пользу**: "Главное — это ваше здоровье..."

## Настройка системы

В коде `src/lib/advancedPatientAI.ts`:

```typescript
private randomObjectionChance = 0.25; // 25% шанс случайного возражения
```

Можно изменить вероятность:
- `0.1` = 10% (редкие возражения)
- `0.25` = 25% (умеренно, по умолчанию)
- `0.4` = 40% (частые возражения, сложный пациент)
- `0.5` = 50% (очень сложный пациент)

## Технические детали

### Условия появления возражений:
```typescript
// НЕ генерируем в первых 2-х сообщениях
if (messageCount < 3) return null;

// НЕ генерируем если администратор отлично работает
if (adminProfile.empathyLevel > 75 && adminProfile.responsivenessLevel > 70) {
  return null;
}

// Случайный шанс возражения
if (Math.random() > this.randomObjectionChance) return null;
```

### Приоритет в генерации ответа:
1. **Случайное возражение** (25% шанс, после 3-го сообщения)
2. Эмоциональная реакция на поведение админа
3. Прямое цитирование фраз админа
4. Учёт нерешённых вопросов
5. Реакция на конкретные темы
6. Противоречия в ответах
7. Стратегические элементы
8. Базовый ответ

## Когда возражения НЕ появляются

- ✅ **Отличный админ** (эмпатия >75%, отзывчивость >70%) — возражений нет
- ✅ **Первые 2 сообщения** — пациент ещё слушает
- ✅ **Вероятность не сработала** — 75% времени возражений не будет

## Эффект от системы возражений

### Для пользователя (администратора):
- Более реалистичный опыт общения с пациентом
- Тренировка работы с возражениями
- Понимание как реагировать на сомнения клиентов
- Развитие навыков убеждения

### Для AI-пациента:
- Более естественное поведение
- Непредсказуемость как у живого человека
- Имитация реальных ситуаций из продаж
- Вариативность диалогов

## Сценарии использования

### Сценарий 1: Тренировка работы с возражениями
Администратор практикуется отвечать на случайные сомнения пациентов, учится находить аргументы и убеждать.

### Сценарий 2: Проверка коммуникативных навыков
Система проверяет как администратор реагирует на неожиданные возражения без подготовки.

### Сценарий 3: Создание реалистичного опыта
Пациент ведёт себя как настоящий клиент в медицинской клинике — иногда сомневается без веских причин.

## Статистика и аналитика

После разговора система может показать:
- Сколько возражений было
- Какие типы возражений появились
- Как администратор отработал каждое возражение
- Какие возражения остались без ответа
- Рекомендации по улучшению работы с возражениями

---

**Система случайных возражений делает AI-пациента максимально похожим на настоящего клиента из реальной практики продаж и консультаций.**
